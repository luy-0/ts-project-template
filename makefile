# ==============================================================================
# é¡¹ç›®ï¼šT3 Turbo å…¨æ ˆå¼€å‘ç®¡ç†
# é€‚ç”¨ï¼šæœ¬åœ°å¼€å‘ä¸è°ƒè¯• (æ—  Docker ç¯å¢ƒ)
# ==============================================================================

.PHONY: all help install dev build db-push db-studio clean lint

# é»˜è®¤ç›®æ ‡ï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
all: help

help:
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  make install     - å®‰è£…æ‰€æœ‰ä¾èµ– (pnpm)"
	@echo "  make dev         - å¯åŠ¨å…¨æ ˆå¼€å‘ç¯å¢ƒ (Next.js, Expo, tRPC)"
	@echo "  make db-push     - æ¨é€æœ¬åœ° Drizzle Schema åˆ°æ•°æ®åº“"
	@echo "  make db-studio   - å¯åŠ¨æ•°æ®åº“ UI ç®¡ç†ç•Œé¢ (Drizzle Studio)"
	@echo "  make build       - æ‰§è¡Œå…¨æ ˆæ„å»º"
	@echo "  make lint        - æ‰§è¡Œå…¨é‡ä»£ç æ£€æŸ¥"
	@echo "  make clean       - æ¸…ç†ç¼“å­˜ä¸ node_modules"

# 1. ä¾èµ–å®‰è£…
# ------------------------------------------------------------------------------
install:
	@echo "ğŸš€ æ­£åœ¨å®‰è£…é¡¹ç›®ä¾èµ–..."
	pnpm install

# 2. æ•°æ®åº“æ“ä½œ (åŸºäº Drizzle ORM)
# ------------------------------------------------------------------------------
# æ³¨æ„ï¼šè¿è¡Œå‰è¯·ç¡®ä¿ .env ä¸­å·²é…ç½® DATABASE_URL
db-push:
	@echo "ğŸ“¤ æ­£åœ¨åŒæ­¥æ•°æ®åº“ç»“æ„..."
	pnpm db:push

db-studio:
	@echo "ğŸ“Š å¯åŠ¨æ•°æ®åº“ç®¡ç†åå° (æµè§ˆå™¨æ‰“å¼€: http://localhost:4983)..."
	pnpm db:studio

# 3. å¼€å‘ä¸å¯åŠ¨
# ------------------------------------------------------------------------------
dev:
	@echo "âœ¨ æ­£åœ¨å¯åŠ¨å…¨æ ˆå¼€å‘æœåŠ¡å™¨..."
	@echo "ğŸ’¡ Web ç«¯åœ°å€: http://localhost:3000"
	@echo "ğŸ’¡ App ç«¯è°ƒè¯•å™¨: http://localhost:19000"
	@pnpm dev

# 4. æ„å»ºä¸æ ¡éªŒ
# ------------------------------------------------------------------------------
build:
	@echo "ğŸ—ï¸ å¼€å§‹å…¨é‡æ„å»º..."
	pnpm build

lint:
	@echo "ğŸ” æ‰§è¡Œä»£ç è§„èŒƒæ£€æŸ¥..."
	pnpm lint

# 5. æ¸…ç†
# ------------------------------------------------------------------------------
clean:
	@echo "ğŸ§¹ æ­£åœ¨æ¸…ç†ç¼“å­˜å’Œæ„å»ºäº§ç‰©..."
	rm -rf node_modules
	rm -rf apps/*/node_modules
	rm -rf packages/*/node_modules
	rm -rf apps/*/.next
	rm -rf apps/*/.expo
	@echo "âœ… æ¸…ç†å®Œæˆ"
